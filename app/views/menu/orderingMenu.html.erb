<style>
    ul {
        list-style-type: none !important; 
        margin-left: 10px !important;
        margin-right: 10px !important;
        padding-left: 0px !important;
        padding-right: 0px !important;
    }
    .quick_options{
        margin-top: 15px !important;
        margin-bottom: 15px !important;
    }
    /* Styles for the popup overlay */
    .overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
    overflow-y: auto;
    }

    /* Styles for the popup content */
    .popup {
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }
</style>

<% if !session[:isBreakfast]%>
    <h1>Lunch / Dinner Menu</h1>
    <table>
    <tr>
        <th>Food Name</th>
        <th>Food Mods</th>
        <th>Total Cost</th>
        <% if session[:customer] != nil%>
            <th>Edit Item</th>
            <th>Order Item</th>
        <% end %>
    </tr>
    <% if !@lunchAndDinnerMenu.blank?%>
        <% @lunchAndDinnerMenu.each  do |lunchItem| %>
            <tr>
                <th><%= lunchItem.food_name %></th>
                <% data = eval(lunchItem.food_additions) rescue [] %>
                <% additions = data.is_a?(Array) ? data : [data] %>
                <th>
                <% additions.each do |addition| %>
                    <h4>ID: <%= addition['id'] %>, Name: <%= addition['addition_name'] %>, Cost: <%= addition['cost'] %></h4>
                <% end %>
                </th>
                <th><%= lunchItem.inital_cost %></th>
                <% if session[:customer] != nil%>
                    <th><%= link_to "Edit Item", menu_show_path(lunchItem), class: "btn btn-primary" %></th>
                    <th>
                        <%= form_with(model: TempOrder.new, method: :post) do |form| %>
                        <%= form.hidden_field :customer_id, value: session[:customer]['id'] %>
                        <%= form.hidden_field :food_id, value: lunchItem.id %>
                        <%= form.hidden_field :total_cost, value: lunchItem.inital_cost %>
                        <%= form.submit "Add to Order"%>
                        <% end %>
                    </th>
                <% end %>
            <tr>
        <% end%>
    <% end %>
    </table>
<% else %>
    <div style="padding-top:20px; padding-left:10px">
        <h1 class="text-2xl md:text-3xl pl-2 my-2 border-l-4 font-sans font-bold dark:text-gray-800" style="border-color:#0CC0DF;">Breakfast Menu</h1>
    </div>


    <!-- Loop to get all foods -->
    <div class="p-4 max-w-lg mx-auto">
        <% id = -1 %>
        <% Food.all.group_by(&:tag).each do |tag, foods| %>
        <details class="mb-2">
            <summary class="bg-gray-200 p-4 rounded-lg cursor-pointer shadow-md mb-4">
            <span class="font-semibold"><%= tag %></span>
            </summary>

            <% foods.each do |food| %>
            <% id += 1 %>
            <div>
                <!-- Additional details for "Eggs" go here -->
                <ul class="ml-8 space-y-4">
                <% if food.tag == "Eggs" %>
                    <li>
                    <details class="mb-2">
                        <summary class="bg-gray-100 p-3 rounded-lg cursor-pointer shadow">
                        <span class="font-semibold"><%= food.food_name %></span>
                        </summary>
                        <div class="bg-white p-1">
                        <span class="text-gray-600"><%= food.description %></span>
                        </div>
                        <div class="flex flex-col md:flex-row justify-between items-center text-gray-900">
                        <p class="font-bold text-xl">$<%= number_with_precision(food.inital_cost, precision: 2) %></p>

                        <!-- Your button -->
                        <button class="popup-trigger px-3 py-1 transition ease-in duration-200 uppercase rounded-full hover:bg-gray-800 hover:text-white border-2 border-gray-900 focus:outline-none" data-popup-id="<%= id %>" style="font-size:14px">
                            <i class="fa fa-cart-plus" style="font-size:16px"></i> add to order
                        </button>

                        <!-- The popup overlay -->
                        <div class="overlay overlay_<%= id %>">
                            <!-- The popup content -->
                            <div class="popup">
                            <button class="closePopup" style="padding-left:300px"><i class="fa fa-window-close" style="font-size: 24px;color:#F0512F;"></i></button>
                            <h3 style="margin-top:0px !important"><%= food.food_name %></h3>
                            <p>Are there any food modifications?</p>
                            <p>{modifications}</p>
                            <p>I will turn the modifications into buttons.</p>
                            <div class="flex gap-6">
                                <button class="bg-gray-600 rounded-full w-32 h-11 text-white font-semibold cancel">
                                <div class="flex gap-4 justify-center items-center">
                                    <span>
                                    <i class="fa fa-close"></i>
                                    </span>
                                    <span>Cancel</span>
                                </div>
                                </button>
                                <div style="width: 10px;"></div>
                                <%= form_with(model: TempOrder.new, method: :post) do |form| %>
                                    <button class="bg-green-600 rounded-full w-32 h-11 text-white font-semibold">
                                        <div class="flex gap-4 justify-center items-center">
                                            <span>
                                            <i class="fa fa-check"></i>
                                            </span>
                                                <%= form.hidden_field :customer_id, value: session[:customer]['id'] %>
                                                <%= form.hidden_field :food_id, value: food.id %>
                                                <%= form.hidden_field :total_cost, value: food.inital_cost %>
                                                <span><%= form.submit "Confirm" %></span>
                                        </div>
                                    </button>
                                <% end %>
                            </div>
                            </div>
                        </div>
                        </details>
                    </li>
                    <% elsif food.tag == "Breads and Hotcakes" %>
                    <li>
                    <details class="mb-2">
                        <summary class="bg-gray-100 p-3 rounded-lg cursor-pointer shadow">
                        <span class="font-semibold"><%= food.food_name %></span>
                        </summary>
                        <div class="bg-white p-1">
                        <span class="text-gray-600"><%= food.description %></span>
                        </div>
                        <div class="flex flex-col md:flex-row justify-between items-center text-gray-900">
                        <p class="font-bold text-xl">$<%= number_with_precision(food.inital_cost, precision: 2) %></p>

                        <!-- Your button -->
                        <button class="popup-trigger px-3 py-1 transition ease-in duration-200 uppercase rounded-full hover:bg-gray-800 hover:text-white border-2 border-gray-900 focus:outline-none" data-popup-id="<%= id %>" style="font-size:14px">
                            <i class="fa fa-cart-plus" style="font-size:16px"></i> add to order
                        </button>

                        <!-- The popup overlay -->
                        <div class="overlay overlay_<%= id %>">
                            <!-- The popup content -->
                            <div class="popup">
                            <button class="closePopup" style="padding-left:300px"><i class="fa fa-window-close" style="font-size: 24px;color:#F0512F;"></i></button>
                            <h3 style="margin-top:0px !important"><%= food.food_name %></h3>
                            <p>Are there any food modifications?</p>
                            <p>{modifications}</p>
                            <p>I will turn the modifications into buttons.</p>
                            
                            <div class="flex gap-6">
                                <button class="bg-gray-600 rounded-full w-32 h-11 text-white font-semibold cancel">
                                <div class="flex gap-4 justify-center items-center">
                                    <span>
                                    <i class="fa fa-close"></i>
                                    </span>
                                    <span>Cancel</span>
                                </div>
                                </button>
                                <div style="width: 10px;"></div>

                                <%= form_with(model: TempOrder.new, method: :post) do |form| %>
                                    <button class="bg-green-600 rounded-full w-32 h-11 text-white font-semibold">
                                        <div class="flex gap-4 justify-center items-center">
                                            <span>
                                            <i class="fa fa-check"></i>
                                            </span>
                                                <%= form.hidden_field :customer_id, value: session[:customer]['id'] %>
                                                <%= form.hidden_field :food_id, value: food.id %>
                                                <%= form.hidden_field :total_cost, value: food.inital_cost %>
                                                <span><%= form.submit "Confirm" %></span>
                                        </div>
                                    </button>
                                <% end %>
                            </div>
                            </div>
                        </div>
                        </details>
                    </li>
                    <% else %>
                        <li>
                        <details class="mb-2">
                            <summary class="bg-gray-100 p-3 rounded-lg cursor-pointer shadow">
                            <span class="font-semibold"><%= food.food_name %></span>
                            </summary>
                            <div class="bg-white p-1">
                            <span class="text-gray-600"><%= food.description %></span>
                            </div>
                            <div class="flex flex-col md:flex-row justify-between items-center text-gray-900">
                            <p class="font-bold text-xl">$<%= number_with_precision(food.inital_cost, precision: 2) %></p>

                            <!-- Your button -->
                            <button class="popup-trigger px-3 py-1 transition ease-in duration-200 uppercase rounded-full hover:bg-gray-800 hover:text-white border-2 border-gray-900 focus:outline-none" data-popup-id="<%= id %>" style="font-size:14px">
                                <i class="fa fa-cart-plus" style="font-size:16px"></i> add to order
                            </button>

                            <!-- The popup overlay -->
                            <div class="overlay overlay_<%= id %>">
                                <!-- The popup content -->
                                <div class="popup">
                                <button class="closePopup" style="padding-left:300px"><i class="fa fa-window-close" style="font-size: 24px;color:#F0512F;"></i></button>
                                <h3 style="margin-top:0px !important"><%= food.food_name %></h3>
                                <p>Are there any food modifications?</p>
                                <p>{modifications}</p>
                                <p>I will turn the modifications into buttons.</p>
                                
                                <div class="flex gap-6">
                                    <button class="bg-gray-600 rounded-full w-32 h-11 text-white font-semibold cancel">
                                    <div class="flex gap-4 justify-center items-center">
                                        <span>
                                        <i class="fa fa-close"></i>
                                        </span>
                                        <span>Cancel</span>
                                    </div>
                                    </button>
                                    <div style="width: 10px;"></div>

                                    <%= form_with(model: TempOrder.new, method: :post) do |form| %>
                                        <button class="bg-green-600 rounded-full w-32 h-11 text-white font-semibold">
                                            <div class="flex gap-4 justify-center items-center">
                                                <span>
                                                <i class="fa fa-check"></i>
                                                </span>
                                                    <%= form.hidden_field :customer_id, value: session[:customer]['id'] %>
                                                    <%= form.hidden_field :food_id, value: food.id %>
                                                    <%= form.hidden_field :total_cost, value: food.inital_cost %>
                                                    <span><%= form.submit "Confirm" %></span>
                                            </div>
                                        </button>
                                    <% end %>
                                </div>
                                </div>
                            </div>
                            </details>
                        </li>
                    <% end %>
                </ul>
                </div>
            <% end %>
            </details>
        <% end %>
    </div>

<script>
  document.querySelectorAll('.popup-trigger').forEach(function (button) {
    button.addEventListener('click', function () {
      var popupId = this.dataset.popupId;
      document.querySelector('.overlay.overlay_' + popupId).style.display = 'flex';
    });
  });

  document.querySelectorAll('.closePopup').forEach(function (closeButton) {
    closeButton.addEventListener('click', function () {
      document.querySelectorAll('.overlay').forEach(function (overlay) {
        overlay.style.display = 'none';
      });
    });
  });

  document.querySelectorAll('.cancel').forEach(function (cancelButton) {
    cancelButton.addEventListener('click', function () {
      document.querySelectorAll('.overlay').forEach(function (overlay) {
        overlay.style.display = 'none';
      });
    });
  });
</script>




    

    <style>
    .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
    }

    /* Styles for the scrollable popup content */
    .popup-container {
        max-height: 80vh;
        overflow-y: auto;
    }

    .popup {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }
    </style>
    <!-- The popup overlay -->
    <div id="customer_view_overlay" class="overlay">
    <!-- The popup content -->
     <div class="popup-container">
    <div class="popup">
        <button id="close_customer_view" style="padding-left:300px"><i class="fa fa-window-close" style="font-size: 24px;color:#F0512F;"></i></button>
        <% if !session[:customer].blank? %>
            <% foodIds = [] %>
            <% foodNotes = [] %>


            <h3 style="margin-top:0px !important">Hello, <%= session[:customer]["first_name"] %>.</h3>
            <p>Below is your current order:</p>
            <% @customers_temp_orders.each do |orderedItme| %>
            <p style="margin: 0 !important;" class="font-semibold"><%= Food.find_by_id(orderedItme.food_id).food_name %></p>
            <p style="margin: 0 !important; padding: 0 !important;"><%= orderedItme.food_modifications %></p>
            <p style="margin: 0 !important;" class="text-green-600"><span style="color:black">+</span> $<%= number_with_precision(orderedItme.total_cost, precision: 2) %></p>
            <div style="padding-top:10px">
            <button class="bg-transparent hover:bg-red-500 text-red-700 font-semibold hover:text-white py-2 px-2 border border-red-500 hover:border-transparent rounded" style="padding-top:2px !important;padding-bottom:2px !important">
            Remove
            </button>
            </div>
                <hr class="quick_options">
                <% foodIds.append(orderedItme.food_id) %>
                <% foodNotes.append(orderedItme.food_modifications) %>
            <% end %>
        <% end %>
        <p>Total price: $<%= number_with_precision(@total, precision: 2) %></p>

        <div class="flex gap-6">
        <button class="bg-gray-600 rounded-full w-32 h-11 text-white font-semibold" id="close_customer">
            <div class="flex gap-4 justify-center items-center">
            <span>
                <i class="fa fa-close"></i>
            </span>
            <span>Cancel</span>
            </div>
        </button>
        <div style="width: 10px;"></div>
        <button class="bg-green-600 rounded-full w-32 h-11 text-white font-semibold">
            <div class="flex gap-4 justify-center items-center">
            <span>
                <i class="fa fa-check"></i>
            </span>
            <span>
                <%= form_with(model: Order.new, method: :post) do |form| %>
                <%= form.hidden_field :list_food_id, value: foodIds %>
                <%= form.hidden_field :list_food_notes, value: foodNotes %>
                <%= form.hidden_field :total_cost, value: @total %>
                <%= form.submit "Submit", class: "btn btn-primary" %>
                <% end %>
            </span>
            </div>
        </button>
        </div>
        </div>

    </div>
    </div>

    <script>
    // JavaScript to handle the popup
    document.getElementById('open_customer_view').addEventListener('click', function () {
        document.getElementById('customer_view_overlay').style.display = 'flex';
    });

    document.getElementById('close_customer_view').addEventListener('click', function () {
        document.getElementById('customer_view_overlay').style.display = 'none';
    });
    document.getElementById('close_customer').addEventListener('click', function () {
        document.getElementById('customer_view_overlay').style.display = 'none';
    });
    </script>

    <table>
    <tr>
        <th>Food Name</th>
        <th>Food Mods</th>
        <th>Total Cost</th>
        <% if session[:customer] != nil and Time.now >= Time.parse("7:00") and Time.now <= Time.parse("12:00")%>
            <th></th>
            <th></th>
        <% end %>
    </tr>
    <% if !@breakfastMenu.blank?%>
        <% @breakfastMenu.each  do |breakfastItem| %>
            <tr>
                <th><%= breakfastItem.food_name %></th>
                <% data = eval(breakfastItem.food_additions) rescue [] %>
                <% additions = data.is_a?(Array) ? data : [data] %>
                <th>
                <% additions.each do |addition| %>
                <% if addition %>
                    <h4>ID: <%= addition['id'] %>, Name: <%= addition['addition_name'] %>, Cost: <%= addition['cost'] %></h4>
                <% end %>
                <% end %>

                </th>
                <th><%= breakfastItem.inital_cost %></th>
                <% if session[:customer] != nil and Time.now >= Time.parse("7:00") and Time.now <= Time.parse("12:00")%>
                    <th><%= link_to "Edit Item", menu_show_path(breakfastItem), class: "btn btn-primary" %></th>
                    <th>
                        <%= form_with(model: TempOrder.new, method: :post) do |form| %>
                        <%= form.hidden_field :customer_id, value: session[:customer]['id'] %>
                        <%= form.hidden_field :food_id, value: breakfastItem.id %>
                        <%= form.hidden_field :total_cost, value: breakfastItem.inital_cost %>
                        <%= form.submit "Add to Order" %>
                        <% end %>
                    </th>
                <% end %>
            <tr>
        <% end%>
    <% end %>
    </table>
<% end %>
<% if session[:isBreakfast] %>
    <% if session[:customer] != nil && Time.now >= Time.parse("7:00") && Time.now <= Time.parse("12:00") %>
        <%= link_to "Complete Order", order_confirmation_path, class: "btn btn-primary" %>
    <% elsif session[:customer] == nil %>
        <%= link_to "Log In to order food", login_path, class: "btn btn-primary" %>
    <% else %>
        <h3>YOU CANNOT ORDER BREAKFAST AFTER 12 YOU WEIRDOS</h3>
    <% end %>
<% else %>
    <% if session[:customer] != nil %>
        <%= link_to "Complete Order", order_confirmation_path, class: "btn btn-primary" %>
    <% else %>
        <%= link_to "Log In to order food", login_path, class: "btn btn-primary" %>
    <% end %>
<% end %>

<br>
<%= link_to "Go Back to the Menu", menu_order_path, class: "btn btn-primary" %>
